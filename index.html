<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Midwest Escape 1998</title>
<style>
body { margin:0; overflow:hidden; background:black; }
#ui {
position:absolute;
top:20px;
left:20px;
color:white;
font-family:monospace;
z-index:10;
}
button {
padding:8px;
background:black;
color:white;
border:1px solid white;
cursor:pointer;
}
</style>
</head>
<body>

<div id="ui">
<div id="message">Find the EXIT sign</div>
<button id="retry" style="display:none;">Retry</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>

<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);
scene.fog = new THREE.Fog(0x000000, 20, 120);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,2,50);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// 広い地面
const floorGeometry = new THREE.PlaneGeometry(300,300);
const floorMaterial = new THREE.MeshStandardMaterial({color:0x1a1a1a});
const floor = new THREE.Mesh(floorGeometry, floorMaterial);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// 環境光（少し明るく）
const ambient = new THREE.AmbientLight(0x505050);
scene.add(ambient);

// 懐中電灯
const flashlight = new THREE.SpotLight(0xffffff,6,80,Math.PI/7,0.5);
scene.add(flashlight);
scene.add(flashlight.target);

// 敵
const enemyGeometry = new THREE.BoxGeometry(3,6,3);
const enemyMaterial = new THREE.MeshStandardMaterial({color:0xffffff});
const enemy = new THREE.Mesh(enemyGeometry, enemyMaterial);
enemy.position.set(0,3,-80);
scene.add(enemy);

// 出口
const exitGeometry = new THREE.BoxGeometry(10,10,2);
const exitMaterial = new THREE.MeshStandardMaterial({color:0x00ff00});
const exitDoor = new THREE.Mesh(exitGeometry, exitMaterial);
exitDoor.position.set(0,5,-140);
scene.add(exitDoor);

let keys = {};
document.addEventListener("keydown", e=>keys[e.code]=true);
document.addEventListener("keyup", e=>keys[e.code]=false);

let gameOver=false;
let enemySpeed=0.03;

function resetGame(){
camera.position.set(0,2,50);
enemy.position.set(0,3,-80);
enemySpeed=0.03;
gameOver=false;
document.getElementById("retry").style.display="none";
document.getElementById("message").innerText="Find the EXIT sign";
}

document.getElementById("retry").onclick=resetGame;

function animate(){
requestAnimationFrame(animate);

if(!gameOver){

let moveSpeed = keys["ShiftLeft"] ? 0.6 : 0.3;

if(keys["KeyW"]) camera.position.z -= moveSpeed;
if(keys["KeyS"]) camera.position.z += moveSpeed;
if(keys["KeyA"]) camera.position.x -= moveSpeed;
if(keys["KeyD"]) camera.position.x += moveSpeed;

// ライト追従
flashlight.position.copy(camera.position);
flashlight.target.position.set(
camera.position.x,
camera.position.y,
camera.position.z - 10
);

// 敵追跡
let dx = camera.position.x - enemy.position.x;
let dz = camera.position.z - enemy.position.z;
let dist = Math.sqrt(dx*dx + dz*dz);

enemy.position.x += dx/dist * enemySpeed;
enemy.position.z += dz/dist * enemySpeed;

// 徐々に速くなる
enemySpeed += 0.00002;

if(dist < 5){
gameOver=true;
document.getElementById("message").innerText="YOU WERE CAUGHT";
document.getElementById("retry").style.display="block";
}

// 脱出判定
let exitDist = Math.sqrt(
(camera.position.x - exitDoor.position.x)**2 +
(camera.position.z - exitDoor.position.z)**2
);

if(exitDist < 10){
gameOver=true;
document.getElementById("message").innerText="YOU ESCAPED";
document.getElementById("retry").style.display="block";
}

}

renderer.render(scene,camera);
}

animate();
</script>
</body>
</html>

animate();
</script>
</body>
</html>
