<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Midwest Escape 1998</title>
<style>
body { margin:0; overflow:hidden; background:black; }
#ui{
position:absolute;
top:20px;
left:20px;
color:white;
font-family:monospace;
background:rgba(0,0,0,0.6);
padding:10px;
}
</style>
</head>
<body>

<div id="ui">ESCAPE THE STREET</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>

<script>

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x050510); // 夜空色

const camera = new THREE.PerspectiveCamera(
75,
window.innerWidth/window.innerHeight,
0.1,
1000
);
camera.position.set(0,5,20);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// 月明かり
const moon = new THREE.DirectionalLight(0x8899ff, 1.5);
moon.position.set(50,100,50);
scene.add(moon);

// うっすら環境光
const ambient = new THREE.AmbientLight(0x404040,0.6);
scene.add(ambient);

// アスファルト
const roadGeo = new THREE.PlaneGeometry(200,200);
const roadMat = new THREE.MeshStandardMaterial({
color: 0x222222
});
const road = new THREE.Mesh(roadGeo,roadMat);
road.rotation.x = -Math.PI/2;
scene.add(road);

// 街灯
for(let i=-80;i<=80;i+=40){
const poleGeo = new THREE.CylinderGeometry(0.3,0.3,10);
const poleMat = new THREE.MeshStandardMaterial({color:0xaaaaaa});
const pole = new THREE.Mesh(poleGeo,poleMat);
pole.position.set(i,5,-30);
scene.add(pole);

const light = new THREE.PointLight(0xffddaa,2,30);
light.position.set(i,10,-30);
scene.add(light);
}

// プレイヤー
const playerGeo = new THREE.BoxGeometry(2,4,2);
const playerMat = new THREE.MeshStandardMaterial({color:0xffffff});
const player = new THREE.Mesh(playerGeo,playerMat);
player.position.y = 2;
scene.add(player);

// 敵
const enemyGeo = new THREE.BoxGeometry(3,6,3);
const enemyMat = new THREE.MeshStandardMaterial({color:0x550000});
const enemy = new THREE.Mesh(enemyGeo,enemyMat);
enemy.position.set(0,3,-80);
scene.add(enemy);

// 懐中電灯
const flashlight = new THREE.SpotLight(0xffffff,5,50,Math.PI/6,0.5);
scene.add(flashlight);
scene.add(flashlight.target);

let keys = {};
document.addEventListener("keydown", e=>keys[e.code]=true);
document.addEventListener("keyup", e=>keys[e.code]=false);

let gameOver=false;

function animate(){
requestAnimationFrame(animate);

if(!gameOver){

if(keys["KeyW"]) player.position.z -= 0.4;
if(keys["KeyS"]) player.position.z += 0.4;
if(keys["KeyA"]) player.position.x -= 0.4;
if(keys["KeyD"]) player.position.x += 0.4;

// カメラ追従
camera.position.x = player.position.x;
camera.position.z = player.position.z + 20;
camera.lookAt(player.position);

// 懐中電灯追従
flashlight.position.copy(player.position);
flashlight.position.y += 2;
flashlight.target.position.set(
player.position.x,
player.position.y,
player.position.z - 10
);

// 敵追跡
let dx = player.position.x - enemy.position.x;
let dz = player.position.z - enemy.position.z;
let dist = Math.sqrt(dx*dx + dz*dz);

enemy.position.x += dx/dist * 0.05;
enemy.position.z += dz/dist * 0.05;

if(dist < 4){
gameOver=true;
document.getElementById("ui").innerHTML="YOU WERE CAUGHT";
}

}

renderer.render(scene,camera);
}

animate();

</script>
</body>
</html>
