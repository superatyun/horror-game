<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HORROR CITY NIGHTMARE</title>
<style>
body { margin:0; overflow:hidden; background:black; }
#ui{
 position:absolute;
 top:10px;
 left:10px;
 color:white;
 font-family:sans-serif;
}
#staminaBar{
 width:200px;
 height:20px;
 background:#333;
 margin-top:5px;
}
#stamina{
 height:100%;
 width:100%;
 background:lime;
}
#scare{
 position:fixed;
 top:0;
 left:0;
 width:100%;
 height:100%;
 background:black;
 display:none;
 justify-content:center;
 align-items:center;
 font-size:100px;
 color:white;
}
</style>
</head>
<body>

<div id="ui">
WASDÁßªÂãï / „Éû„Ç¶„ÇπË¶ñÁÇπ / Shift„ÉÄ„ÉÉ„Ç∑„É• / FÊåØ„ÇäÂêë„Åç<br>
<div id="staminaBar"><div id="stamina"></div></div>
</div>

<div id="scare">üëÅ</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158/build/three.min.js"></script>
<script>
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x0a0a1a);

const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
camera.position.set(0,1.7,0);

const renderer=new THREE.WebGLRenderer();
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0x404040,2));
const moon=new THREE.DirectionalLight(0x8888ff,1);
moon.position.set(5,10,5);
scene.add(moon);

// Âú∞Èù¢
const ground=new THREE.Mesh(
 new THREE.PlaneGeometry(200,200),
 new THREE.MeshStandardMaterial({color:0x111111})
);
ground.rotation.x=-Math.PI/2;
scene.add(ground);

// ===== Âª∫Áâ© =====
const buildingBoxes=[];

function createHouse(x,z){
 const base=new THREE.Mesh(
   new THREE.BoxGeometry(4,4,4),
   new THREE.MeshStandardMaterial({color:0x444488})
 );
 base.position.set(x,2,z);
 scene.add(base);

 const roof=new THREE.Mesh(
   new THREE.ConeGeometry(3.5,2,4),
   new THREE.MeshStandardMaterial({color:0x222233})
 );
 roof.position.set(x,5,z);
 roof.rotation.y=Math.PI/4;
 scene.add(roof);

 const box=new THREE.Box3().setFromObject(base);
 buildingBoxes.push(box);
}

for(let x=-25;x<=25;x+=6){
 for(let z=-25;z<=25;z+=6){
   if(Math.random()>0.15){
     createHouse(x,z);
   }
 }
}

// ===== Êïµ =====
const enemy=new THREE.Mesh(
 new THREE.BoxGeometry(2,5,2),
 new THREE.MeshStandardMaterial({color:0xaa0000})
);
enemy.position.set(-20,2.5,-20);
scene.add(enemy);

// ===== Êìç‰Ωú =====
const keys={};
document.addEventListener("keydown",e=>{
 keys[e.key.toLowerCase()]=true;
 if(e.key.toLowerCase()==="f"){
   camera.rotation.y+=Math.PI;
 }
});
document.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

document.body.addEventListener("click",()=>{
 document.body.requestPointerLock();
});

let pitch=0,yaw=0;
document.addEventListener("mousemove",e=>{
 if(document.pointerLockElement===document.body){
   yaw-=e.movementX*0.002;
   pitch-=e.movementY*0.002;
   pitch=Math.max(-Math.PI/2,Math.min(Math.PI/2,pitch));
   camera.rotation.set(pitch,yaw,0);
 }
});

// ===== „Çπ„Çø„Éü„Éä =====
let stamina=100;
const staminaEl=document.getElementById("stamina");

function move(){
 let speed=0.12;
 if(keys["shift"] && stamina>0){
   speed=0.25;
   stamina-=0.6;
 }else{
   stamina+=0.3;
 }
 stamina=Math.max(0,Math.min(100,stamina));
 staminaEl.style.width=stamina+"%";
 staminaEl.style.background=stamina<30?"red":"lime";

 const dir=new THREE.Vector3();
 camera.getWorldDirection(dir);
 dir.y=0;
 dir.normalize();

 const right=new THREE.Vector3();
 right.crossVectors(dir,camera.up);

 let nextPos=camera.position.clone();

 if(keys["w"]) nextPos.addScaledVector(dir,speed);
 if(keys["s"]) nextPos.addScaledVector(dir,-speed);
 if(keys["a"]) nextPos.addScaledVector(right,-speed);
 if(keys["d"]) nextPos.addScaledVector(right,speed);

 const playerBox=new THREE.Box3().setFromCenterAndSize(
   new THREE.Vector3(nextPos.x,1.7,nextPos.z),
   new THREE.Vector3(1,2,1)
 );

 let collision=false;
 for(let box of buildingBoxes){
   if(playerBox.intersectsBox(box)){
     collision=true;
     break;
   }
 }

 if(!collision){
   camera.position.x=nextPos.x;
   camera.position.z=nextPos.z;
 }

 camera.position.y=1.7;
}

// ===== ÊïµËøΩË∑° =====
let scareCooldown=0;

function updateEnemy(){
 const dx=camera.position.x-enemy.position.x;
 const dz=camera.position.z-enemy.position.z;
 const dist=Math.sqrt(dx*dx+dz*dz);

 if(dist>2){
   enemy.position.x+=dx/dist*0.04;
   enemy.position.z+=dz/dist*0.04;
 }else{
   jumpscare();
 }

 enemy.lookAt(camera.position);
}

// ===== „Ç∏„É£„É≥„Éó„Çπ„Ç±„Ç¢ =====
function jumpscare(){
 if(scareCooldown>0)return;
 scareCooldown=200;
 const scare=document.getElementById("scare");
 scare.style.display="flex";
 setTimeout(()=>{
   scare.style.display="none";
   camera.position.set(0,1.7,0);
   enemy.position.set(-20,2.5,-20);
 },1000);
}

function animate(){
 requestAnimationFrame(animate);
 move();
 updateEnemy();
 if(scareCooldown>0)scareCooldown--;
 renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
